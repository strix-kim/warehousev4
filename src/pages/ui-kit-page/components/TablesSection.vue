<template>
  <section>
    <h2 class="text-xl font-bold text-primary mb-6">üóÇÔ∏è Table v2 - Enterprise Data Table</h2>
    <BentoGrid columns="1" gap="6">
      <!-- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Table v2 -->
      <BentoCard title="–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Table v2">
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
          <div class="flex items-center gap-2">
            <StatusBadgeV2 size="xs" label="‚úì" variant="success" />
            <span class="text-sm text-secondary">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</span>
          </div>
          <div class="flex items-center gap-2">
            <StatusBadgeV2 size="xs" label="‚úì" variant="success" />
            <span class="text-sm text-secondary">–ü–æ–∏—Å–∫</span>
          </div>
          <div class="flex items-center gap-2">
            <StatusBadgeV2 size="xs" label="‚úì" variant="success" />
            <span class="text-sm text-secondary">–°–µ–ª–µ–∫—Ü–∏—è</span>
          </div>
          <div class="flex items-center gap-2">
            <StatusBadgeV2 size="xs" label="‚úì" variant="success" />
            <span class="text-sm text-secondary">–ü–∞–≥–∏–Ω–∞—Ü–∏—è</span>
          </div>
          <div class="flex items-center gap-2">
            <StatusBadgeV2 size="xs" label="‚úì" variant="success" />
            <span class="text-sm text-secondary">Loading</span>
          </div>
          <div class="flex items-center gap-2">
            <StatusBadgeV2 size="xs" label="‚úì" variant="success" />
            <span class="text-sm text-secondary">Error states</span>
          </div>
          <div class="flex items-center gap-2">
            <StatusBadgeV2 size="xs" label="‚úì" variant="success" />
            <span class="text-sm text-secondary">Responsive</span>
          </div>
          <div class="flex items-center gap-2">
            <StatusBadgeV2 size="xs" label="‚úì" variant="success" />
            <span class="text-sm text-secondary">Slots</span>
          </div>
        </div>
      </BentoCard>

      <!-- –ó–∞–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö —Ç–∞–±–ª–∏—Ü -->
      <BentoCard title="–ó–∞–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö —Ç–∞–±–ª–∏—Ü">
        <div class="space-y-3">
          <p class="text-sm">
            <strong class="text-primary">EquipmentTable.vue:</strong> 385 —Å—Ç—Ä–æ–∫ ‚Üí Table v2
          </p>
          <p class="text-sm">
            <strong class="text-primary">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å:</strong> –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
          </p>
          <p class="text-sm">
            <strong class="text-primary">–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:</strong> –ï–¥–∏–Ω—ã–π UX –ø–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ
          </p>
          <p class="text-sm">
            <strong class="text-primary">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
          </p>
        </div>
      </BentoCard>
    </BentoGrid>

    <!-- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã -->
    <BentoCard title="–ü—Ä–æ—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" size="2x1" scrollable>


      <!-- –ü—Ä–æ—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
      <TableV2 
        :data="tableData"
        :columns="columns"
        :loading="loading"
        :sort-by="sortBy"
        :sort-direction="sortDirection"
        :clickable-rows="true"
        :sticky-header="true"
        :max-body-height="300"
        @sort="handleSort"
        @row-click="handleRowClick"
      >
        <template #caption>
          –°–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–¥–µ–º–æ), –∑–∞–ª–∏–ø–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–∫—Ä–æ–ª–ª
        </template>
        <!-- –ö–∞—Å—Ç–æ–º–Ω–∞—è —è—á–µ–π–∫–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ -->
        <template #cell-status="{ value }">
          <StatusBadgeV2 
            :label="getStatusLabel(value)" 
            :variant="getStatusVariant(value)" 
            size="sm" 
          />
        </template>
        
        <!-- –ö–∞—Å—Ç–æ–º–Ω–∞—è —è—á–µ–π–∫–∞ –¥–ª—è —Ü–µ–Ω—ã -->
        <template #cell-price="{ value }">
          <span class="font-mono text-primary">{{ formatPrice(value) }}</span>
        </template>
        
        <!-- –ö–∞—Å—Ç–æ–º–Ω–∞—è —è—á–µ–π–∫–∞ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π -->
        <template #cell-actions="{ item }">
          <div class="flex gap-2">
            <ButtonV2 variant="ghost" size="sm" @click.stop="editItem(item)">
              <IconV2 name="edit" size="xs" />
            </ButtonV2>
            <ButtonV2 variant="error" size="sm" @click.stop="deleteItem(item)">
              <IconV2 name="trash-2" size="xs" />
            </ButtonV2>
          </div>
        </template>
      </TableV2>
    </BentoCard>

    <!-- –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
    <BentoCard title="–ü–∞–≥–∏–Ω–∞—Ü–∏—è" size="1x1">
      <PaginationV2
        :current-page="currentPage"
        :total-pages="totalPages"
        :total-items="totalItems"
        :items-per-page="itemsPerPage"
        :items-per-page-options="itemsPerPageOptions"
        @update:current-page="currentPage = $event"
        @update:items-per-page="itemsPerPage = $event"
      />
    </BentoCard>

    <!-- –ö–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <BentoCard title="–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π">
      <div class="flex gap-3 flex-wrap">
        <ButtonV2 variant="primary" size="sm" @click="showLoading">–ü–æ–∫–∞–∑–∞—Ç—å Loading</ButtonV2>
        <ButtonV2 variant="warning" size="sm" @click="showError">–ü–æ–∫–∞–∑–∞—Ç—å Error</ButtonV2>
        <ButtonV2 variant="ghost" size="sm" @click="clearData">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</ButtonV2>
      </div>
    </BentoCard>
  </section>
</template>

<script setup>
import { ref, computed } from 'vue'
import { 
  BentoGrid,
  BentoCard, 
  TableV2, 
  ButtonV2,
  StatusBadgeV2,
  PaginationV2,
  SelectV2,
  IconV2
} from '@/shared/ui-v2'

// –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
const loading = ref(false)
const searchQuery = ref('')
const sortBy = ref('')
const sortDirection = ref('asc')
const currentPage = ref(1)
const itemsPerPage = ref(5)

// –¢–µ—Å—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
const testCurrentPage = ref(3)

// –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
const mockData = [
  {
    id: 1,
    name: 'Camera Sony FX6',
    category: '–í–∏–¥–µ–æ–∫–∞–º–µ—Ä—ã',
    location: '–°–∫–ª–∞–¥ –ê',
    status: 'available',
    price: 450000
  },
  {
    id: 2,
    name: '–ú–∏–∫—Ä–æ—Ñ–æ–Ω Rode NTG4+',
    category: '–ê—É–¥–∏–æ',
    location: '–°–∫–ª–∞–¥ –ë',
    status: 'in-use',
    price: 25000
  },
  {
    id: 3,
    name: '–®—Ç–∞—Ç–∏–≤ Manfrotto',
    category: '–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã',
    location: '–¶–µ—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞',
    status: 'maintenance',
    price: 15000
  },
  {
    id: 4,
    name: 'LED Panel Aputure 300D',
    category: '–û—Å–≤–µ—â–µ–Ω–∏–µ',
    location: '–°–∫–ª–∞–¥ –ê',
    status: 'available',
    price: 85000
  },
  {
    id: 5,
    name: 'Monitor Atomos Ninja V',
    category: '–ú–æ–Ω–∏—Ç–æ—Ä—ã',
    location: '–û—Ñ–∏—Å–Ω–æ–µ –∑–¥–∞–Ω–∏–µ',
    status: 'retired',
    price: 45000
  }
]

const tableData = ref([...mockData])

// –ö–æ–ª–æ–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
const columns = [
  {
    key: 'name',
    label: '–ù–∞–∑–≤–∞–Ω–∏–µ',
    sortable: true
  },
  {
    key: 'category',
    label: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è',
    sortable: true
  },
  {
    key: 'location',
    label: '–õ–æ–∫–∞—Ü–∏—è'
  },
  {
    key: 'status',
    label: '–°—Ç–∞—Ç—É—Å'
  },
  {
    key: 'price',
    label: '–¶–µ–Ω–∞',
    sortable: true
  },
  {
    key: 'actions',
    label: '–î–µ–π—Å—Ç–≤–∏—è'
  }
]

// –û–ø—Ü–∏–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
const itemsPerPageOptions = [
  { label: '5', value: 5 },
  { label: '10', value: 10 },
  { label: '20', value: 20 },
  { label: '50', value: 50 }
]

// Computed —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
const totalItems = computed(() => tableData.value.length)
const totalPages = computed(() => Math.ceil(totalItems.value / itemsPerPage.value))
const startItem = computed(() => (currentPage.value - 1) * itemsPerPage.value + 1)
const endItem = computed(() => Math.min(currentPage.value * itemsPerPage.value, totalItems.value))

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
const handleSort = ({ column, direction }) => {
  sortBy.value = column
  sortDirection.value = direction
  console.log('Sorting by:', column, direction)
}

const handleRowClick = (row) => {
  console.log('Row clicked:', row)
}

// –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
const getStatusLabel = (status) => {
  const statusMap = {
    available: '–î–æ—Å—Ç—É–ø–Ω–æ',
    'in-use': '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è',
    maintenance: '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
    retired: '–°–ø–∏—Å–∞–Ω–æ'
  }
  return statusMap[status] || status
}

const getStatusVariant = (status) => {
  const variantMap = {
    available: 'success',
    'in-use': 'warning',
    maintenance: 'warning',
    retired: 'error'
  }
  return variantMap[status] || 'secondary'
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
const formatPrice = (price) => {
  return `${price.toLocaleString('ru-RU')} ‚ÇΩ`
}

// –î–µ–π—Å—Ç–≤–∏—è —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
const editItem = (item) => {
  console.log('Edit item:', item)
}

const deleteItem = (item) => {
  console.log('Delete item:', item)
}

// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π
const showLoading = () => {
  loading.value = true
  setTimeout(() => {
    loading.value = false
  }, 2000)
}

const showError = () => {
  tableData.value = []
  // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å error —Å–æ—Å—Ç–æ—è–Ω–∏–µ
}

const clearData = () => {
  tableData.value = []
}

// –î–æ–±–∞–≤–∏–º —Ç–µ—Å—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
// –ü–æ–º–æ–∂–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏–∫–æ–Ω–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
</script>