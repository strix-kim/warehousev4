<template>
  <BentoCard 
    title="–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" 
    size="1x1" 
    variant="default"
  >
    <FormV2 
      :show-actions="false"
      submit-text=""
      reset-text=""
    >
      <div class="space-y-6">
        
        <!-- –®–ê–ì 1: –¢–∏–ø —Å–ø–∏—Å–∫–∞ (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ) -->
        <FormFieldV2 
          type="custom"
          label="–¢–∏–ø —Å–ø–∏—Å–∫–∞"
          required
          :hint="isEditMode ? '–¢–∏–ø —Å–ø–∏—Å–∫–∞ –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è' : '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–ø–∏—Å–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è'"
          :error="formErrors.type"
        >
          <div class="space-y-3">
            <label 
              class="flex items-start gap-3 p-4 border rounded-lg transition-colors"
              :class="[
                { 'border-primary bg-primary/5': formData.type === 'custom' },
                isEditMode ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer hover:bg-gray-50'
              ]"
            >
              <input 
                type="radio" 
                :checked="formData.type === 'custom'"
                @change="() => { formData.type = 'custom'; handleTypeChange(); }"
                :disabled="isEditMode"
                class="mt-1 disabled:opacity-50 disabled:cursor-not-allowed"
              />
              <div>
                <div class="font-medium text-primary">üÜì –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–ø–∏—Å–æ–∫</div>
                <div class="text-sm text-secondary">
                  –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é
                </div>
              </div>
            </label>
            
            <label 
              class="flex items-start gap-3 p-4 border rounded-lg transition-colors"
              :class="[
                { 'border-primary bg-primary/5': formData.type === 'security' },
                isEditMode ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer hover:bg-gray-50'
              ]"
            >
              <input 
                type="radio" 
                :checked="formData.type === 'security'"
                @change="() => { formData.type = 'security'; handleTypeChange(); }"
                :disabled="isEditMode"
                class="mt-1 disabled:opacity-50 disabled:cursor-not-allowed"
              />
              <div>
                <div class="font-medium text-primary">üîí –°–ø–∏—Å–æ–∫ –¥–ª—è –æ—Ö—Ä–∞–Ω—ã</div>
                <div class="text-sm text-secondary">
                  –°–ø–∏—Å–æ–∫ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é –∏ —Ç–æ—á–∫–µ –º–æ–Ω—Ç–∞–∂–∞ –¥–ª—è –Ω—É–∂–¥ –æ—Ö—Ä–∞–Ω—ã
                </div>
              </div>
            </label>
          </div>
        </FormFieldV2>

        <!-- –®–ê–ì 2: –î–µ—Ç–∞–ª–∏ —Å–ø–∏—Å–∫–∞ (–∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–∏–ø–∞) -->
        <div v-if="formData.type" class="space-y-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
          <div class="flex items-center gap-2 mb-3">
            <span class="text-primary">‚úèÔ∏è</span>
            <h4 class="font-medium text-primary">–î–µ—Ç–∞–ª–∏ —Å–ø–∏—Å–∫–∞</h4>
          </div>

          <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ -->
          <FormFieldV2 
            v-if="formData.type === 'custom'"
            type="text"
            :model-value="formData.name"
            @update:model-value="handleNameChange"
            label="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞"
            required
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å—Ü–µ–Ω—ã –ê"
            :error="formErrors.name"

          />

          <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è security —Å–ø–∏—Å–∫–∞ -->
          <div v-if="formData.type === 'security'">
            <!-- –í —Ä–µ–∂–∏–º–µ —Å–æ–∑–¥–∞–Ω–∏—è: –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è -->
            <FormFieldV2 
              v-if="!isEditMode"
              type="custom"
              label="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞"
              hint="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∞–∂–∞"
            >
              <div class="p-3 bg-white border border-gray-300 rounded-md">
                <div class="text-sm font-medium text-primary break-words leading-relaxed">
                  {{ autoGeneratedName || '–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –∏ —Ç–æ—á–∫—É –º–æ–Ω—Ç–∞–∂–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è' }}
                </div>
              </div>
            </FormFieldV2>
            
            <!-- –í —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞ -->
            <FormFieldV2 
              v-else
              type="text"
              label="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞"
              hint="–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞"
              :model-value="formData.name"
              @update:model-value="handleNameChange"
              required
              :error="formErrors.name"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞"
            />
            

          </div>

          <!-- –û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ -->
          <FormFieldV2 
            v-if="formData.type === 'custom'"
            type="textarea"
            :model-value="formData.description"
            @update:model-value="handleDescriptionChange"
            label="–û–ø–∏—Å–∞–Ω–∏–µ"
            hint="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞"
            placeholder="–û–ø–∏—à–∏—Ç–µ –¥–ª—è —á–µ–≥–æ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫..."
            :rows="3"
            :error="formErrors.description"

          />

          <!-- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è security —Å–ø–∏—Å–∫–∞ -->
          <FormFieldV2 
            v-if="formData.type === 'security'"
            type="custom"
            label="–û–ø–∏—Å–∞–Ω–∏–µ"
            hint="–û–ø–∏—Å–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
          >
            <div class="p-3 bg-white border border-gray-300 rounded-md">
              <div class="text-sm text-secondary">
                {{ autoGeneratedDescription || '–û–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∞–∂–∞' }}
              </div>
            </div>
          </FormFieldV2>
        </div>

      </div>
    </FormV2>
  </BentoCard>
</template>

<script setup>
/**
 * ListBasicInfoForm - EPR System
 * 
 * –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–æ—Ä–º—ã –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
 * –í–∫–ª—é—á–∞–µ—Ç –≤—ã–±–æ—Ä —Ç–∏–ø–∞ —Å–ø–∏—Å–∫–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
 * 
 * @component
 * @example
 * <ListBasicInfoForm
 *   :form-data="formData"
 *   :form-errors="formErrors"
 *   :auto-generated-name="autoName"
 *   :auto-generated-description="autoDesc"
 *   @update:form-data="handleFormDataUpdate"
 *   @update:form-errors="handleFormErrorsUpdate"
 *   @type-change="handleTypeChange"
 * />
 */

import { 
  BentoCard,
  FormV2,
  FormFieldV2
} from '@/shared/ui-v2'

// ===== PROPS =====
const props = defineProps({
  formData: {
    type: Object,
    required: true,
    validator: (value) => {
      return typeof value === 'object' && 
             value !== null &&
             'type' in value &&
             'name' in value &&
             'description' in value
    }
  },
  formErrors: {
    type: Object,
    default: () => ({})
  },
  autoGeneratedName: {
    type: String,
    default: ''
  },
  autoGeneratedDescription: {
    type: String,
    default: ''
  },
  isEditMode: {
    type: Boolean,
    default: false
  }
})

// ===== EMITS =====
const emit = defineEmits([
  'update:form-data',
  'update:form-errors',
  'type-change'
])

// ===== –ú–ï–¢–û–î–´ =====
const handleTypeChange = () => {
  console.log('üìù [ListBasicInfoForm] –ò–∑–º–µ–Ω–µ–Ω —Ç–∏–ø —Å–ø–∏—Å–∫–∞:', props.formData.type)
  
  // –≠–º–∏—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  emit('type-change', props.formData.type)
  
  // –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∏–ø–∞
  const newErrors = { ...props.formErrors }
  delete newErrors.type
  delete newErrors.name
  delete newErrors.description
  emit('update:form-errors', newErrors)
}

const handleNameChange = (value) => {
  console.log('üìù [ListBasicInfoForm] –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ:', value)
  
  const updatedFormData = {
    ...props.formData,
    name: value
  }
  emit('update:form-data', updatedFormData)
  
  // –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫—É –Ω–∞–∑–≤–∞–Ω–∏—è –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞
  if (props.formErrors.name) {
    const newErrors = { ...props.formErrors }
    delete newErrors.name
    emit('update:form-errors', newErrors)
  }
}

const handleDescriptionChange = (value) => {
  console.log('üìù [ListBasicInfoForm] –ò–∑–º–µ–Ω–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ:', value)
  
  const updatedFormData = {
    ...props.formData,
    description: value
  }
  emit('update:form-data', updatedFormData)
  
  // –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫—É –æ–ø–∏—Å–∞–Ω–∏—è –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞
  if (props.formErrors.description) {
    const newErrors = { ...props.formErrors }
    delete newErrors.description
    emit('update:form-errors', newErrors)
  }
}
</script>

<style scoped>
/* UI Kit v2 + Bento Grid —Å—Ç–∏–ª–∏ */

/* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è —Ä–∞–¥–∏–æ –∫–Ω–æ–ø–æ–∫ */
.cursor-pointer {
  transition: all 0.2s ease;
}

.cursor-pointer:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.border-primary {
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è layout */
.space-y-6 > * + * {
  margin-top: 1.5rem;
}

.space-y-4 > * + * {
  margin-top: 1rem;
}

.space-y-3 > * + * {
  margin-top: 0.75rem;
}
</style>