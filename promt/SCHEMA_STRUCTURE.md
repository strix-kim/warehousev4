# Структура файлов схемы базы данных

## Актуальные файлы

### **Основные файлы схемы:**

1. **`supabase_schema.sql`** - Основная схема базы данных
   - Создание всех таблиц (users, equipments, events, mount_points, reports)
   - Оптимизированные RLS политики с `(select auth.uid())`
   - Полная структура для продакшена с полями created_at/updated_at

2. **`equipment_lists_schema.sql`** - Схема для списков оборудования
   - Таблица equipment_lists с индексами и триггерами
   - Поддержка различных типов списков (security, report, custom)

3. **`equipment_lists_rls_policies.sql`** - RLS политики для списков оборудования
   - Политики доступа к таблице equipment_lists
   - Оптимизированные с `(select auth.role())`

### **Файлы оптимизации производительности:**

4. **`complete_rls_optimization.sql`** - Полный скрипт очистки и оптимизации
   - Удаляет ВСЕ старые политики
   - Создает новые оптимизированные политики
   - Решает все проблемы с производительностью

5. **`rls_performance_optimization.sql`** - Альтернативный скрипт оптимизации
   - Замена `auth.uid()` на `(select auth.uid())`
   - Улучшение производительности запросов

6. **`fix_equipment_policies.sql`** - Удаление проблемных политик equipment
   - Удаляет старые политики "Users can view equipment" и т.д.

7. **`check_policies.sql`** - Проверка всех RLS политик
   - Диагностика состояния политик в базе данных

8. **`RLS_PERFORMANCE_OPTIMIZATION.md`** - Документация по оптимизации
   - Объяснение проблемы и решения
   - Примеры до/после оптимизации

## Удаленные устаревшие файлы

### **Удалены следующие файлы:**
- `supabase_schema_fix.sql` - Исправления включены в основную схему
- `mount_points_schema_update.sql` - Обновления включены в основную схему  
- `mount_points_enhancement_migration.sql` - Миграция уже применена
- `optimized_rls_policies.sql` - Дублировал основную схему
- `supabase_seed.sql` - Тестовые данные, не нужны в продакшене

## Рекомендации по использованию

### **Для новой установки:**
1. Выполните `supabase_schema.sql` для создания основной структуры
2. Выполните `equipment_lists_schema.sql` для добавления списков оборудования
3. Выполните `equipment_lists_rls_policies.sql` для настройки доступа

### **Для оптимизации существующей базы:**
1. Выполните `rls_performance_optimization.sql` для улучшения производительности

### **Для понимания оптимизации:**
1. Изучите `RLS_PERFORMANCE_OPTIMIZATION.md` для понимания принципов

## Структура таблиц

### **Основные таблицы:**
- `users` - Пользователи системы
- `equipments` - Оборудование
- `events` - Мероприятия
- `mount_points` - Точки монтажа
- `reports` - Отчеты

### **Дополнительные таблицы:**
- `equipment_lists` - Списки оборудования

## Безопасность

Все таблицы защищены RLS политиками с оптимизированной производительностью:
- Использование `(select auth.uid())` вместо `auth.uid()`
- Ролевая модель доступа (video_engineer, technician, manager, admin)
- Привязка к конкретным пользователям и мероприятиям 