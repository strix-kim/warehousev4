#!/bin/bash

echo "üîç –ü–æ–∏—Å–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ..."
echo "================================================"

# –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ–≥–¥–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ (—Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞, —Å—Ç—Ä–∞–Ω–∏—Ü—ã, index.js)
EXCLUDED_FILES=(
    "src/main.js"
    "src/App.vue"
    "src/app/layout.vue"
    "src/app/router.js"
    "src/pages/*.vue"
    "src/features/*/index.js"
    "src/shared/index.js"
)

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π
echo "" > excluded_patterns.txt
for pattern in "${EXCLUDED_FILES[@]}"; do
    echo "$pattern" >> excluded_patterns.txt
done

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º
is_excluded() {
    local file="$1"
    while IFS= read -r pattern; do
        if [[ "$file" == $pattern ]]; then
            return 0  # –ò—Å–∫–ª—é—á–µ–Ω
        fi
    done < excluded_patterns.txt
    return 1  # –ù–µ –∏—Å–∫–ª—é—á–µ–Ω
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ..."
echo ""

DEAD_FILES=()
TOTAL_FILES=0

while IFS= read -r file; do
    TOTAL_FILES=$((TOTAL_FILES + 1))
    
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    if is_excluded "$file"; then
        echo "‚úÖ $file (–∏—Å–∫–ª—é—á–µ–Ω - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞/—Å—Ç—Ä–∞–Ω–∏—Ü–∞/index.js)"
        continue
    fi
    
    # –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
    filename=$(basename "$file")
    name_without_ext="${filename%.*}"
    
    # –ò—â–µ–º –∏–º–ø–æ—Ä—Ç—ã —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –≤–æ –≤—Å–µ—Ö .js –∏ .vue —Ñ–∞–π–ª–∞—Ö
    if grep -r --include="*.js" --include="*.vue" --include="*.ts" -l "$name_without_ext" src/ > /dev/null 2>&1; then
        echo "‚úÖ $file (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)"
    else
        echo "‚ùå $file (–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø!)"
        DEAD_FILES+=("$file")
    fi
done < all_files.txt

echo ""
echo "================================================"
echo "üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê:"
echo "================================================"
echo "–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: $TOTAL_FILES"
echo "–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤: ${#DEAD_FILES[@]}"

if [ ${#DEAD_FILES[@]} -gt 0 ]; then
    echo ""
    echo "üö® –ù–ê–ô–î–ï–ù–´ –ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –§–ê–ô–õ–´:"
    echo "================================================"
    for file in "${DEAD_FILES[@]}"; do
        echo "  - $file"
    done
    echo ""
    echo "üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:"
    echo "  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç–∏ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º"
    echo "  - –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏"
    echo "  - –ò–ª–∏ —è–≤–ª—è—é—Ç—Å—è –∑–∞–≥–æ—Ç–æ–≤–∫–∞–º–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞"
else
    echo ""
    echo "üéâ –í—Å–µ —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è! –ú–µ—Ä—Ç–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ."
fi

# –û—á–∏—Å—Ç–∫–∞
rm -f all_files.txt excluded_patterns.txt 